/*! red5pro-host-html-sdk - v0.4.3 - 2014-09-24
* Copyright (c) 2014 Infrared5; Licensed  */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){this.buffer=[]}function d(a){this._input=a,this._index=-1,this._buffer=[]}function e(a){this._input=a,this._index=-1,this._buffer=[]}c.prototype.append=function(a){return this.buffer.push(a),this},c.prototype.toString=function(){return this.buffer.join("")};var f={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){for(var b=new c,e=new d(a);e.moveNext();){var f=e.current;e.moveNext();var g=e.current;e.moveNext();var h=e.current,i=f>>2,j=(3&f)<<4|g>>4,k=(15&g)<<2|h>>6,l=63&h;isNaN(g)?k=l=64:isNaN(h)&&(l=64),b.append(this.codex.charAt(i)+this.codex.charAt(j)+this.codex.charAt(k)+this.codex.charAt(l))}return b.toString()},decode:function(a){for(var b=new c,d=new e(a);d.moveNext();){var f=d.current;if(128>f)b.append(String.fromCharCode(f));else if(f>191&&224>f){d.moveNext();var g=d.current;b.append(String.fromCharCode((31&f)<<6|63&g))}else{d.moveNext();var g=d.current;d.moveNext();var h=d.current;b.append(String.fromCharCode((15&f)<<12|(63&g)<<6|63&h))}}return b.toString()}};d.prototype={current:Number.NaN,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var a=this._input.charCodeAt(++this._index);return 13==a&&10==this._input.charCodeAt(this._index+1)&&(a=10,this._index+=2),128>a?this.current=a:a>127&&2048>a?(this.current=a>>6|192,this._buffer.push(63&a|128)):(this.current=a>>12|224,this._buffer.push(a>>6&63|128),this._buffer.push(63&a|128)),!0}},e.prototype={current:64,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var a=f.codex.indexOf(this._input.charAt(++this._index)),b=f.codex.indexOf(this._input.charAt(++this._index)),c=f.codex.indexOf(this._input.charAt(++this._index)),d=f.codex.indexOf(this._input.charAt(++this._index)),e=a<<2|b>>4,g=(15&b)<<4|c>>2,h=(3&c)<<6|d;return this.current=e,64!=c&&this._buffer.push(g),64!=d&&this._buffer.push(h),!0}},b.exports=f},{}],2:[function(){},{}],3:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],4:[function(a,b){"use strict";var c="iphone",d="ipod",e="ipad",f=a("../environment/index"),g=f.getUserAgent().toLowerCase(),h=f.getAppName();b.exports={detectIphone:function(){return g.search(c)>-1},detectIpad:function(){return g.search(e)>-1},detectIpod:function(){return g.search(d)>-1},detectIOS:function(){return this.detectIphone()||this.detectIpod()||this.detectIpad()},detectAndroid:function(){return g.indexOf("android")>-1},detectInternetExplorerVersion:function(){var a=-1;if("Microsoft Internet Explorer"===h){var b=new RegExp(/msie ([0-9]{1,}[\.0-9]{0,})/);null!=b.exec(g)&&(a=parseFloat(RegExp.$1))}return a},onLoad:function(a){var b=Array.prototype.slice.call(arguments).slice(1),c=function(){a.apply(null,b)};f.loadComplete()?c():f.addLoadListener(c)}}},{"../environment/index":25}],5:[function(a,b){"use strict";var c=a("../../environment/index"),d=a("../../util/resource-util"),e=a("../../util/bind"),f=a("../../log/logger"),g=f.getLogger("Flash Util"),h=96,i=function(a,b){c.injectScript(a,b)},j=function(a){g.info("embedding..."),c.getSwfObject().embedSWF(a.url,a.id,"1","1",a.version,"",a.flashvars,a.params,a.attributes,function(b){b.success===!1?a.error("Could not properly embed Flash fallback."):b.success===!0&&a.success()})},k=function(a,b){var f={id:void 0,flashvars:void 0,url:b.options.swfUrl,version:"9.0.124",params:{quality:"high",bgcolor:"#ffffff",allowscriptaccess:"always",allowfullscreen:"true"},attributes:{id:b.flashObjID,name:"Red5 Pro SecondScreen Host",align:"middle",style:"float:left;z-index:-1;position:absolute;margin-top:-1px;"},error:e(b.options._error,b.options),success:e(b.options._success,b.options)},k=b.options.controlsUrl,l=c.createElement("div");l.id="red5pro-secondscreen-host-wrapper"+Math.floor(16777215*Math.random()*16777215).toString(16),c.appendElementToBody(l),l.style.zIndex=1e4,l.style.position="fixed",l.style.width="8px",l.style.height="8px",l.style.left="0px",l.style.bottom="0px",l.style.overflowX="hidden",l.style.overflowY="hidden";var m=c.createElement("div");m.id="red5pro-secondscreen-host-wrapper"+Math.floor(16777215*Math.random()*16777215).toString(16),c.appendElementToContainer(m,l);var n={globalName:c.globalName,bmDeviceName:encodeURIComponent(b.options.name),bmControllerXML:void 0,bmControllerUrl:void 0!==k?c.getAbsoluteUrl(k):void 0,wmode:"window",debug:"true"};g.info("Flash Object global name: "+n.globalName+"."),b&&b.options&&void 0!==b.options.appId&&void 0!==b.options.portalId?(n.bmDeviceId=b.options.appId,n.bmPortalId=b.options.portalId):n.bmDeviceId=Math.floor(16777215*Math.random()*16777215).toString(16),n.bmMaxPlayers=void 0!==b.options.maxPlayers?b.options.maxPlayers:h,b.deviceId=b.options.deviceId=n.bmDeviceId,d.generateControllerXML(b.options.design,function(a){n.bmControllerXML=encodeURIComponent(a),f.id=m.id,f.flashvars=n,"undefined"==typeof c.getSwfObject()?(g.info("Inject swfobject..."),i(b.options.swfobjectUrl,function(){j(f)})):(g.info("Embed SWF with swfobject."),j(f))})};b.exports={initializeFlashObject:k,getFlashObjectById:function(a){return c.getElement(a)}}},{"../../environment/index":25,"../../log/logger":27,"../../util/bind":33,"../../util/resource-util":38}],6:[function(a,b){"use strict";var c=a("../struct/base-classes"),d=a("../event/bridge"),e=a("../enum/encoding-type"),f=a("../util/debounce"),g=a("../util/bind"),h=a("../environment/index"),i=a("../log/logger"),j=a("../enum/error-type"),k=d.EventTypes,l=function(a,b){this.host=a,this.reliablePort=b,this.unreliablePort=b},m=function(a,b,c){this.methodName=a,this.returnMethod=b,this.data=c,this.ws=32},n=function(a,b){this.deviceId=a,this.deviceName=b,this.deviceType="WEBSOCKET",this.encodeType=e.FLASH},o="ws://54.82.36.3:6262/secondscreen",p={REGISTER:{method:"registry.register",handler:"onRegister"},UPDATE:{method:"registry.update",handler:""},VISIBILITY:{method:"registry.setVisible",handler:""}},q=function(a,b){return new m(a.method,a.handler,b)},r=function(a){var b,c=a.length,d=[];for(b=0;c>b;b++)d[b]=a[b].value;return d},s=function(a,b){a._error.apply(a,[j.REGISTER_FAILURE,b])},t=c.EventEmitter.extend({init:function(a){this.domain={value:"secondscreen"},this.clientInfo={appId:a.options.appId,device:new n(a.options.deviceId,a.options.name),address:new l("192.168.2.1",6666),slotId:1,currentPlayers:0,maxPlayers:a.options.maxPlayers},this.hostConfig=a,this.websocket=null,this.registryUrl=a.options.registryUrl||o,this.update=f(this.update,500,this),this.logger=i.getLogger("WebSocket Registry"),this.logger.info("New Registry created for url "+this.registryUrl+"."),this.logger.info("Application id "+this.clientInfo.appId)},start:function(){try{this.logger.info("Request to start registry."),this.websocket=h.createWebSocket(this.registryUrl),this.websocket.onopen=g(this.onOpen,this),this.websocket.onmessage=g(this.onMessage,this),this.websocket.onerror=g(this.onError,this),this.websocket.onclose=g(this.onClose,this)}catch(a){throw new Error({type:j.REGISTER_FAILURE,message:a.message})}},stop:function(){var a=this.websocket;a.onopen=a.onclose=a.onmessage=a.onerror=null;try{a.close()}catch(b){}this.logger.info("Stopping registry.")},update:function(){var a=q(p.UPDATE,[this.clientInfo]);this.websocket.send(JSON.stringify(a))},setVisibility:function(a){var b=q(p.VISIBILITY,[{value:a},{value:!0}]);this.websocket.send(JSON.stringify(b))},setPlayerCount:function(a){this.logger.info("Setting current player count to "+a),this.clientInfo.currentPlayers=a,this.update()},onOpen:function(){this.logger.info("Registry socket opened.");var a=q(p.REGISTER,[this.clientInfo]);this.websocket.send(JSON.stringify(a))},onClose:function(){this.logger.info("Registry socket closed."),d.trigger(k.REGISTRY_DISCONNECT,{})},onError:function(a){this.logger.error("Registry socket error: "+a.error),s(this.hostConfig.options,a.error),d.trigger(k.REGISTRY_DISCONNECT,{})},onRegister:function(a){a?this.logger.info("Registration accepted."):(this.logger.warn("Registration rejected. Url "+this.registryUrl+", appid: "+this.clientInfo.appId),s(this.hostConfig.options,"[WebSocketRegistryConnection]:: Failed to register"))},onMessage:function(a){var b=JSON.parse(a.data);switch(b.ws){case 32:var c=r(b.data),d=this[b.methodName];"function"==typeof d?(this.logger.info("Method invocation on Registry: "+b.methodName+"."),d.apply(this,c)):this.logger.warn("RegistryConnection function "+b.methodName+" not found: "+b.methodName+".");break;case 35:}},onHostConnected:function(a){a.device.deviceId===this.clientInfo.device.deviceId&&(this.clientInfo=a,d.triggerWithType(k.SHOW_SLOT_COLOR,{data:{slot:a.slotId}}))},onHostUpdate:function(a){a.device.deviceId===this.clientInfo.device.deviceId&&(this.clientInfo=a)},deviceConnectRequested:function(a){d.trigger(k.DEVICE_CONN_REQUEST,a)}});b.exports={WebSocketRegistry:t,createWebSocketRegistry:function(a,b){return new t(a,b)}}},{"../enum/encoding-type":21,"../enum/error-type":22,"../environment/index":25,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/debounce":34}],7:[function(a,b){"use strict";var c=a("../enum/encoding-type"),d=[],e=function(a){return{major:a>>24&255,minor:a>>16&255}},f=function(a){return{encodeType:a[0],type:a[1],id:a[2],name:a[3]}},g=function(a){return{device:f(a[1]),address:n(a[2])}},h=function(a){return{uid:a[1],address:n(a[2])}},i=function(){return{}},j=function(a){return{setId:a[1],startByte:a[2],chunkSize:a[3],totalSize:a[4],data:a[5]}},k=function(a){var b=0,c={};return c.device=f(a[++b]),c.address=n(a[++b]),c.appId=a[++b],c.slotId=a[++b],c.slotId>0&&(c.currentPlayers=a[++b],c.maxPlayers=a[++b]),c},l=function(a){var b=d[a[0]];if(b)return b(a);throw new Error("[websocket-serializer]:: No decoder for "+a)},m=function(a){var b={},c=0;return b.channel=a[++c],b.sequence=a[++c],b.timestamp=a[++c],b.rtt=a[++c],b.type=a[++c],b.deviceType=a[++c],b.deviceId=a[++c],b.deviceName=a[++c],a[++c]&&(b.message=l(a[++c])),b},n=function(a){return{hostname:a[1],udpPort:a[2],tcpPort:a[3]}},o=function(a){var b=a[1],c=a[2];return"@"===b&&(c=l(c)),[b,c]},p=function(a){var b,c,d=0,e=[],f={};for(++d,f.method=a[++d],f.returnMethod=a[++d],f.params=e,b=a[++d],c=d+b;c>d;)e.push(o(a[++d]));return f},q=function(a){return{x:a[1],y:a[2],z:a[3]}},r=function(a){var b,c=0,d=a[++c],e=[];for(b=0;d>b;++b){var f={};f.x=a[++c],f.y=a[++c],f.viewWidth=a[++c],f.viewHeight=a[++c],f.phase=a[++c],f.id=a[++c],e.push(f)}return{touches:e}},s=function(a){return{x:a[1],y:a[2],z:a[3]}},t=function(a){return{x:a[1],y:a[2],z:a[3],w:a[4]}},u=function(a){return{horizontal:a[1],vertical:a[2]}},v=function(a){return{id:a[2],value:a[1],isDown:a[3]}};!function(){d[c.PACKET]=m,d[c.ADDRESS]=n,d[c.PARAMETER]=o,d[c.INVOKE]=p,d[c.ACCELERATION]=q,d[c.TOUCH_SET]=r,d[c.ACK]=g,d[c.PING]=h,d[c.SHAKE]=i,d[c.BYTE_CHUNK]=j,d[c.REGISTRY_INFO]=k,d[c.GYRO]=s,d[c.ORIENTATION]=t,d[c.DPAD]=u,d[c.SLIDER]=v,d[c.DEVICE_IPHONE]=f,d[c.DEVICE_UNITY]=f,d[c.DEVICE_ANDROID]=f,d[c.DEVICE_NATIVE]=f,d[c.DEVICE_PALM]=f,d[c.DEVICE_FLASH]=f}(),b.exports={verifyHandshake:function(a,b,c){return e(a[0])==b&&e(a[1])==c},decodeObject:l,decodePacket:m}},{"../enum/encoding-type":21}],8:[function(a,b){"use strict";var c,d=a("../struct/base-classes"),e=a("../event/bridge"),f=a("../util/bind"),g=a("../util/resource-util"),h=a("../log/logger"),i=a("../enum/control-mode-type"),j=e.EventTypes,k={gyroscope:1,orientation:2},l=function(a,b,c){var d=g.cloneDesign(a);return d.commit=b,d.get=c,d},m=d.EventEmitter.extend({init:function(a,b,c){this._super(),this.id=b||(new Date).getTime().toString(),this.name=a||"Device-"+this.id,this.touchEnabled=!1,this.touchInterval=.1,this.accelerometerEnabled=!1,this.accelerometerInterval=.1,this.gyroEnabled=!1,this.gyroInterval=.1,this.orientationEnabled=!1,this.orientationInterval=.1,this.capabilities=0,this.mode=i.isValid(c)?c:i.GAMEPAD},setMode:function(a){a&&i.isValid(a)&&(this.mode=a)},getMode:function(){return this.mode},hasCapability:function(a){if(!(a in k))throw new Error("unknown capability: "+a);return 0!==(this.capabilities&k[a])}}),n=m.extend({init:function(a,b,c){this._super(a,b,c.options.controlMode),this.config=c,this.touchEnabled=c.options.design.touchEnabled,this.accelerometerEnabled=c.options.design.accelerometerEnabled,this.onConnectionMessage=f(this.onConnectionMessage,this),this.updateControlScheme=f(this.updateControlScheme,this),this.getControlSchemeElement=f(this.getControlSchemeElement,this),this.design=l(this.config.options.design,this.updateControlScheme,this.getControlSchemeElement),this.messageBuilder=void 0,e.on(j.CONNECTION_MESSAGE,this.onConnectionMessage),this.logger=h.getLogger("Generic Device Connection")},close:function(){e.off(j.CONNECTION_MESSAGE,this.onConnectionMessage)},sendInvoke:function(a){throw new Error("Requires override for message: "+a+".")},sendMessageToControls:function(){throw new Error("Requires override.")},updateControlScheme:function(){throw new Error("Requires override.")},getControlSchemeElement:function(a){throw new Error("Requires override for id: "+a+".")},onConnectionMessage:function(a){return a.data.device===this},waitForNewHost:function(a){this.sendInvoke(this.messageBuilder.createWaitForMessage(a)),this.mode=i.WAIT},vibrate:function(){this.sendInvoke(this.messageBuilder.createVibrateMessage())},editDesign:function(){return this.design},setMode:function(a,b){var c;this.mode!==a&&(c=i.index(a),i.isValid(a)?(this.logger&&this.logger.info("Setting new mode "+a+" on Device Connection "+this.id),this.sendInvoke(this.messageBuilder.createSetControlModeMessage(c,b)),this.mode=a):this.logger&&this.logger.error("Unknown control mode "+a))}});!function(a){var b,d=["gyro","touch","accelerometer","orientation"],e=d.length,f=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},g=function(a){var b=f(a);return{enabledField:a+"Enabled",enableMethod:"set"+b+"Enabled",intervalField:a+"Interval",intervalMethod:"set"+b+"Interval",accessEnabledMethod:"get"+b+"Enabled",accessIntervalMethod:"get"+b+"Interval"}},h=function(b){var c=g(b);a[c.enableMethod]=function(a){a!==this[c.enabledField]&&(this.sendInvoke(this.messageBuilder.createSensorEnableMessage(b,a,this[c.intervalField])),this[c.enabledField]=a)},a[c.intervalMethod]=function(a){a!==this[c.intervalField]&&(this.sendInvoke(this.messageBuilder.createSensorIntervalMessage(b,this[c.enabledField],a)),this[c.intervalField]=a)},a[c.accessEnabledMethod]=function(){return this[c.enabledField]},a[c.accessIntervalMethod]=function(){return this[c.intervalField]}},i=function(){for(var a,b=e,c=[];--b>-1;)a=f(d[b]),c.push("set"+a+"Enabled","get"+a+"Enabled","set"+a+"Interval","get"+a+"Interval");return c};for(b=e;--b>-1;)h(d[b]);c=i().concat(["close","setMode","sendMessageToControls"])}(n.prototype),b.exports={Device:m,DeviceConnection:n,DeviceConnectionProxyMethods:c}},{"../enum/control-mode-type":18,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/resource-util":38}],9:[function(a,b){"use strict";var c=a("./device-base"),d=a("./websocket-device"),e=a("./flash-bridge-device");b.exports={getProxyMethods:function(){return c.DeviceConnectionProxyMethods},createDeviceConnection:function(a,b,c){return d.createConnection(a,b,c)},createBridgeConnection:function(a,b,c,d,f){var g=e.createConnection(a,b,d,f);return g.setMode(c),g}}},{"./device-base":8,"./flash-bridge-device":10,"./websocket-device":14}],10:[function(a,b){"use strict";var c=a("./device-base").DeviceConnection,d=a("../event/bridge"),e=a("../util/resource-util"),f=a("./flash-message-builder"),g=a("../log/logger"),h=d.ConnectionEventTypes,i=c.extend({init:function(a,b,c,d){this._super(a,b,c),this.messageBuilder=f,this.invokeChannel=d,this.logger=g.getLogger("Fl Bridge Connection"),this.logger.info("New Bridge Connection created. Name: "+a+", DeviceId: "+b)},updateControlScheme:function(){var a=e.generateUpdateXML(this.design);this.sendInvoke(this.messageBuilder.createControlDesignUpdateMessage(a))},getControlSchemeElement:function(a){for(var b,c=this.design.layout,d=c?c.length:0;--d>-1;)if(b=c[d],b.id===a)return b;return void this.logger.warn("Could not find control scheme element with id "+a+".")},sendMessageToControls:function(a){var b=Array.prototype.splice.call(arguments,1);this.sendInvoke(this.messageBuilder.createMessageToJs(a,b))},sendInvoke:function(a){a.call(this,this.invokeChannel,this.id)},onConnectionMessage:function(a){var b=a.type,c=a.data;this._super(a)&&(this.logger.info("Device Message received: "+b+"."),c.device.id===this.id&&(b===h.CONTROL_SCHEME||b===h.SEND_PORTAL_ID||b===h.SET_CAPABILITIES&&(this.capabilities=c.capabilities?c.capabilities:0),this.trigger(b,a.data)))}});b.exports={createConnection:function(a,b,c,d){return new i(a,b,c,d)}}},{"../event/bridge":26,"../log/logger":27,"../util/resource-util":38,"./device-base":8,"./flash-message-builder":12}],11:[function(a,b){"use strict";var c=a("../struct/base-classes"),d=a("../environment/index"),e=a("../event/bridge"),f=a("../util/json-util"),g=(a("../util/bind"),a("../log/logger")),h=e.EventTypes,i=e.DeviceEventTypes,j=e.ConnectionEventTypes,k=["FlashLoaded","DeviceAvailable","DeviceConnected","DeviceDisconnected","DeviceEcho","NavigationString","TouchesReceived","KeyString","Invocation","ShakeReceived","AccelReceived","DPadReceived","SliderChange","Log","ShowSlot"],l=g.getLogger("Flash Responder"),m={setCapabilities:function(a,b){var c=b[0].Value,d=this.getDeviceById(a.id);l.info("Set capabilities ["+c+"] for device: "+d.id+"."),e.triggerConnectionMessage(j.SET_CAPABILITIES,{device:d,capabilities:c})},bmPause:function(a){l.info("Pause request for device: "+a.id+"."),e.triggerDeviceMessage(i.PAUSE,{device:a})},handleButtonAction:function(a,b,c){var d,f;return"undefined"==typeof c||1!==c.length?!1:(d=c[0].Value,"up"===d||"down"===d?(f="up"===d?i.BUTTON_UP:i.BUTTON_DOWN,e.triggerDeviceMessage(f,{device:a,id:b}),!0):!1)},onControlsUrlChange:function(a,b){e.triggerDeviceMessage(i.CONTROLS_URL_CHANGE,{device:a,url:b[0].Value})},messageFromJs:function(a,b){for(var c,d,g=b[0].Value,h=g.methodName,j=g.parameters,k=[],l=0;l<j.length;++l)c=j[l].Value,d=f.toJSON(c),k[l]="string"==typeof c&&d?d:c;e.triggerDeviceMessage(i.MESSAGE,{device:a,message:h,state:1===k.length?k[0]:k})}},n=c.Class.extend({init:function(a){this.target=a,this.devices={}},getDeviceById:function(a){return this.devices.hasOwnProperty(a)?this.devices[a]:void 0},FlashLoaded:function(){e.triggerConnectionMessage(j.FLASH_RUNTIME_LOADED,{})},ShowSlot:function(a){l.info("Show slot color. id: "+a+"."),e.triggerWithType(h.SHOW_SLOT_COLOR,{data:{slot:a}})},Invocation:function(a,b){var c=this.getDeviceById(b),d=a.parameters,e=a.methodName;l.info("Device Invocation. id: "+b+", invocation: "+JSON.stringify(a,null,2)),m.hasOwnProperty(e)?m[e].call(this,c,d):m.handleButtonAction(c,e,d)||l.warn("Could not handle method invocation. methodName: "+e+".")},DeviceAvailable:function(a){l.info("Device Available. device: "+JSON.stringify(a,null,2)),e.trigger(h.DEVICE_CONN_REQUEST,a)},DeviceConnected:function(a){var b=a.deviceId,c=a.deviceName,d=this.getDeviceById(b);l.info("Device Connected. id: "+b+", name: "+c+"."),d&&(e.triggerConnectionMessage(j.ADD_DEVICE,{device:d}),e.triggerDeviceMessage(i.MESSAGE,{device:d,message:"ready"}))},DeviceDisconnected:function(a){var b=a.deviceId,c=a.deviceName;l.info("Device Disonnected. id: "+b+", name: "+c+"."),e.triggerConnectionMessage(j.REMOVE_DEVICE,{device:this.getDeviceById(b)})},DeviceEcho:function(a,b){l.info("Echo: "+a+".\nDevice:\n"+JSON.stringify(b,null,2))},NavigationString:function(a,b){l.info("Navigation Event. "+b+"."),e.triggerDeviceMessage(i.NAVIGATION,{device:this.getDeviceById(a),string:b})},KeyString:function(a,b){l.info("KeyString Event."+b+"."),e.triggerDeviceMessage(i.KEYBOARD,{device:this.getDeviceById(a),text:b})},TouchesReceived:function(a){var b,c,d,f=a.deviceId,g=a.touches,h=g.length;for(b=0;h>b;b++){switch(c=g[b],c.phase.value){case 1:d=i.TOUCH_START;break;case 2:d=i.TOUCH_MOVE;break;case 4:d=i.TOUCH_END;break;default:l.warn("Could not handle touch type of phase: "+c.phase+".\n"+JSON.stringify(a,null,2))}e.triggerDeviceMessage(d,{device:this.getDeviceById(f),x:c.x,y:c.y,id:f+c.id})}},AccelReceived:function(a){var b=a.deviceId,c=a.acceleration;e.triggerDeviceMessage(i.ACCELERATION,{device:this.getDeviceById(b),acceleration:c})},ShakeReceived:function(a){var b=a.deviceId;e.triggerDeviceMessage(i.SHAKE,{device:this.getDeviceById(b)})},SliderChange:function(a){var b=a.deviceId;e.triggerDeviceMessage(i.SLIDER,{device:this.getDeviceById(b),id:a.sliderId,value:a.value})},DPadReceived:function(a){var b=a.deviceId;e.triggerDeviceMessage(i.DPAD,{device:this.getDeviceById(b),horizontal:a.horizontal,vertical:a.vertical})}}),o=n.extend({init:function(a){this._super(a),d.defineGlobalTarget(this)},register:function(a){l.info("Register connection to bridge responder: "+a.id),this.devices[a.id]=a},unregister:function(a){l.info("Unregister connection to bridge responder: "+a.id),this.devices.hasOwnProperty(a.id)&&delete this.devices[a.id]},unregisterAll:function(){var a;for(a in this.devices)delete this.devices[a]},connectionSuccess:function(a){var b;this.devices.hasOwnProperty(a)?(b=this.devices[a],e.triggerConnectionMessage(j.ADD_DEVICE,{device:b})):l.info("Could not find device registered with id: "+a+".")},boomBa:function(a){l.info("Flash fallback embedded successfully. "+a+".")},log:function(a){l.info("Flash action taken: "+a+".")},helper:{logger:function(){return g.getLogger("Flash Resp.Helper")}(),helperTick:function(){},__noSuchMethod__:function(a,b){this.logger.warn("No such method: "+a+", "+JSON.stringify(b,null,2))}}});!function(a){for(var b,c=k.length,d=function(a){return["on",a,"Internal"].join("")};--c>-1;)b=k[c],a[d(b)]=a[b];a.showSlotInternal=a.ShowSlot,a.__noSuchMethod__=function(a,b){l.warn("No Such Method: "+a+", "+JSON.stringify(b,null,2))}}(o.prototype),b.exports={create:function(a){return new o(a)}}},{"../environment/index":25,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/json-util":36}],12:[function(a,b){"use strict";var c=a("../log/logger"),d=a("../enum/control-mode-type"),e=c.getLogger("Flash Message Builder"),f=function(a){var b=d.value(a),c="SetGamepadMode";switch(b){case d.NAVIGATION:c="SetNavMode";break;case d.KEYBOARD:c="SetKeyboardMode";break;case d.WAIT:c="SetWaitMode"}return e.info("Request Control Mode: "+b+"."),c};b.exports={createSetControlModeMessage:function(a,b){var c=f(a);return function(a,d){return"string"==typeof b?a[c](d,b):a[c](d)}},createWaitForMessage:function(){return function(a,b){return a.SetWaitForNewHost(b)}},createSensorEnableMessage:function(a,b,c){return a=a.charAt(0).toUpperCase()+a.slice(1),function(d,f){return e.info("Enable sensor: "+a+", enabled: "+b+", interval: "+c),d["Enable"+a](f,b,c)}},createSensorIntervalMessage:function(a,b,c){return this.createSensorEnableMessage(a,b,c)},createControlDesignUpdateMessage:function(a,b){return function(c,d){return c.updateControlPad(d,a,b||function(){})}},createVibrateMessage:function(){return function(a,b){return a.VibrateDevice(b)}},createMessageToJs:function(a,b){return function(c,d){return c.MessageToJs(d,a,b)}}}},{"../enum/control-mode-type":18,"../log/logger":27}],13:[function(a,b){"use strict";var c=a("../struct/base-classes"),d=a("../event/bridge"),e=a("../util/json-util"),f=a("../log/logger"),g=a("../enum/channel-type"),h=(d.EventTypes,d.DeviceEventTypes),i=d.ConnectionEventTypes,j=f.getLogger("WebSocket Channel Responder"),k={RequestXML:function(a){d.triggerConnectionMessage(i.CONTROL_SCHEME,{device:a})},GetPortalId:function(a,b){d.triggerConnectionMessage(i.SEND_PORTAL_ID,{device:a,returnMethod:b.returnMethod})},setCapabilities:function(a,b){d.triggerConnectionMessage(i.SET_CAPABILITIES,{device:a,capabilities:b.params[0][1]}),d.triggerConnectionMessage(i.ADD_DEVICE,{device:a})},onControlSchemeParsed:function(a){d.triggerDeviceMessage(h.MESSAGE,{device:a,message:"ready"})},WaitCancelled:function(a){d.triggerDeviceMessage(h.WAIT_CANCELLED,{device:a})},bmPause:function(a){d.triggerDeviceMessage(h.PAUSE,{device:a})},onKeyString:function(a,b){d.triggerDeviceMessage(h.KEYBOARD,{device:a,text:b.params[0][1]})},onNavigationString:function(a,b){d.triggerDeviceMessage(h.NAVIGATION,{device:a,string:b.params[0][1]})},onControlsUrlChange:function(a,b){d.triggerDeviceMessage(h.CONTROLS_URL_CHANGE,{device:a,url:b.params[0][1]})},messageFromJs:function(a,b){for(var c,f,g,i=b.params[0][1],j=i.method,k=i.params,l=0;l<k.length;++l)f=k[l][0],g=k[l][1],c=e.toJSON(g),k[l]="*"===f&&c?c:g;d.triggerDeviceMessage(h.MESSAGE,{device:a,message:j,state:1===k.length?k[0]:k})}},l=function(a,b){var c,e;1===b.params.length&&(c=b.params[0][1],("up"===c||"down"===c)&&(e="up"===c?h.BUTTON_UP:h.BUTTON_DOWN,d.triggerDeviceMessage(e,{device:a,id:b.method})))},m=c.Class.extend({init:function(a){this.target=a},handlePacket:function(a){var b=a.channel,c=a.deviceName,e=a.message,f=e?e.method:void 0;if(void 0!==f&&b===g.MESSAGE)this.target.name=c,j.info("Message received: "+f+"."),k.hasOwnProperty(f)?k[f].call(null,this.target,e):l(this.target,e);else if(g.SHAKE===b)d.triggerDeviceMessage(h.SHAKE,{device:this.target});else if(g.ACCELERATION===b)d.triggerDeviceMessage(h.ACCELERATION,{device:this.target,acceleration:e});else if(g.TOUCH===b){var i,m,n=e.touches,o=n.length;for(i=0;o>i;i++){switch(n[i].phase){case 1:m=h.TOUCH_START;break;case 2:m=h.TOUCH_MOVE;break;case 4:m=h.TOUCH_END}d.triggerDeviceMessage(m,{device:this.target,x:n[i].x,y:n[i].y,id:this.target.id+n[i].id})}}else g.GYRO===b?d.triggerDeviceMessage(h.GYROSCOPE,{device:this.target,gyroscope:e}):g.ORIENTATION===b?d.triggerDeviceMessage(h.ORIENTATION,{device:this.target,orientation:e}):g.DPAD===b?d.triggerDeviceMessage(h.DPAD,{device:this.target,horizontal:e.horizontal,vertical:e.vertical}):g.SLIDER===b&&d.triggerDeviceMessage(h.SLIDER,{device:this.target,id:e.id,value:e.value})}});b.exports={create:function(a){return new m(a)}}},{"../enum/channel-type":17,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/json-util":36}],14:[function(a,b){"use strict";var c=a("./device-base").DeviceConnection,d=a("../event/bridge"),e=a("../encoding/websocket-serializer"),f=a("../decoding/websocket-deserializer"),g=a("./websocket-channel-responder"),h=a("./websocket-message-builder"),i=a("../util/bind"),j=a("../util/resource-util"),k=a("../log/logger"),l=a("../enum/control-mode-type"),m=a("../enum/encoding-type"),n=a("../enum/packet-type"),o=a("../enum/channel-type"),p=d.EventTypes,q=d.ConnectionEventTypes,r=a("../environment/index"),s={major:1,minor:4},t={channel:o.BYTE,message:void 0},u=function(a,b){return b&&(a.major<b.major||a.major===b.major&&a.minor<b.minor)?b:a},v=function(a){return t.message=a,t},w=function(a){return"undefined"!=typeof a},x=c.extend({init:function(a,b,c){this._super(a,b,c),this.sequence=0,this.controlsSent=!1,this.version=s,this.minimumVersion=u(this.version,c.options.minimumVersion),this.messageBuilder=h,this.channelResponder=g.create(this),this.hostDevice=void 0,this.hostAddress=void 0,this.controlScemeChunks=void 0,this.logger=k.getLogger("Connection"),this.logger.info("New Device Connection created. Name: "+a+", DeviceId: "+b)},connect:function(a,b,c){this.url=a,this.hostDevice=b,this.hostAddress=c,this.logger.info("Request to connect on "+a+"."),this.logger.info("HostDevice for Connection "+this.id+": "+this.hostDevice.id),this.socket=r.createWebSocket(this.url),this.socket.onopen=i(this.onOpen,this),this.socket.onmessage=i(this.onInitialMessage,this),this.socket.onerror=i(this.onError,this),this.socket.onclose=i(this.onClose,this)},close:function(){var a=this.socket;"undefined"!=typeof a&&a.close(),this.logger.info("Closing Device Connection "+this.id),d.off(p.CONNECTION_MESSAGE,this.onConnectionMessage)},generatePacket:function(a){return a.sequence=++this.sequence,a.deviceId=this.hostDevice.id,a.deviceType=this.hostDevice.type,a.channel=a.channel||o.BROADCAST,a.type=a.type||n.DATA,a.rtt=0,a.timestamp=0,e.encodePacket(a)},sendInvoke:function(a){var b=this.generatePacket(a);this.logger.info("sendInvoke: "+JSON.stringify(b)),this.socket.send(JSON.stringify(b))},sendChunks:function(a){var b,c=a.length;for(b=0;c>b;++b)this.socket.send(JSON.stringify(this.generatePacket(v(a[b]))))},sendMessageToControls:function(a){var b=Array.prototype.splice.call(arguments,1);this.sendInvoke(this.messageBuilder.createMessageToJs(a,b))},sendControlScheme:function(){var a=this.config.options.controlsUrl;this.mode===l.HTML&&void 0!==a?this.sendInvoke(this.messageBuilder.createControlsUrlMessage(r.getAbsoluteUrl(a))):void 0!==this.controlSchemeChunks?this.sendChunks(this.controlSchemeChunks):!function(a,b){var c;j.generateControllerXML(b,function(b){c=e.generateControlChunks(b),a.controlSchemeChunks=c,a.sendChunks(c)})}(this,this.design)},updateControlScheme:function(){var a=j.generateUpdateXML(this.design);this.sendChunks(e.generateUpdateChunks(a))},getControlSchemeElement:function(a){for(var b,c=this.design.layout,d=c?c.length:0;--d>-1;)if(b=c[d],b.id===a)return b;return void this.logger.warn("Could not find control scheme element with id "+a+".")},onOpen:function(){var a=e.createHandshake(this.version,this.minimumVersion);this.logger.info("Socket Opened. "+this.id),this.socket.send(JSON.stringify(a))},onClose:function(){this.logger.info("Socket Closed. "+this.id),d.trigger(p.CONNECTION_MESSAGE,{type:q.REMOVE_DEVICE,data:{device:this}})},onError:function(a){var b="Could not connect to device websocket layer. Error: "+a.error+", Info: ["+this.id+", "+this.name+"]";this.logger.error("Socket Error. "+b),this.onClose(),d.trigger(p.CONNECTION_MESSAGE,{type:q.DEVICE_ERROR,data:{device:this,error:b}})},onInitialMessage:function(){var a;this.logger.info("Initial handshake received for Device Connection "+this.id),this.socket.onmessage=i(this.onMessage,this),a=this.generatePacket({type:n.ACK,message:{encodeType:m.ACK,device:this.hostDevice,address:this.hostAddress}}),this.socket.send(JSON.stringify(a)),this.sendInvoke(this.messageBuilder.createTouchReliabilityMessage())},onMessage:function(a){var b=JSON.parse(a.data),c=f.decodePacket(b);this.channelResponder.handlePacket(c)},onConnectionMessage:function(a){var b=a.type,c=a.data;if(this._super(a)){if(this.logger.info("Device Message received: "+b),b===q.CONTROL_SCHEME)this.sendControlScheme();else if(b===q.SEND_PORTAL_ID){var d=this.config.options.portalId,e=w(d);this.logger.warn("Is portal id "+d+" valid? "+w(d)),e&&this.sendInvoke(this.messageBuilder.createSendPortalIdMessage(c.returnMethod,d))}else b===q.SET_CAPABILITIES&&(this.capabilities=c.capabilities?c.capabilities:0);
this.trigger(b,a.data)}}});b.exports={createConnection:function(a,b,c){return new x(a,b,c)}}},{"../decoding/websocket-deserializer":7,"../encoding/websocket-serializer":16,"../enum/channel-type":17,"../enum/control-mode-type":18,"../enum/encoding-type":21,"../enum/packet-type":23,"../environment/index":25,"../event/bridge":26,"../log/logger":27,"../util/bind":33,"../util/resource-util":38,"./device-base":8,"./websocket-channel-responder":13,"./websocket-message-builder":15}],15:[function(a,b){"use strict";var c=a("../enum/channel-type"),d=a("../enum/encoding-type"),e=function(a,b,e){return{channel:c.MESSAGE,message:{method:a,returnMethod:b,params:e,encodeType:d.INVOKE}}},f=function(a){if("number"==typeof a)return a===(0|a)?["i",a]:["f",a];if("string"==typeof a||a instanceof String)return["*",a];if("object"==typeof a)return["*",JSON.stringify(a)];if(null===a)return["*",""];throw new Error("unable to encode value: "+a)},g=function(a){for(var b=[],c=0;c<a.length;++c)b[c]=f(a[c]);return{array:b,encodeType:d.TAGGED_ARRAY}};b.exports={createInvokeMessage:e,createSendPortalIdMessage:function(a,b){return e(a,"",[["*",b]])},createTouchReliabilityMessage:function(){return e("setReliabilityForTouch","",[["i",2],["i",2]])},createSetControlModeMessage:function(a,b){var c="SetControlMode",d="";return void 0!==b?e(c,d,[["i",a],["*",b]]):e(c,d,[["i",a]])},createWaitForMessage:function(a){return e("WaitForNewHost",[["*",a]])},createSensorEnableMessage:function(a,b){return a=a.charAt(0).toUpperCase()+a.slice(1),e("enable"+a,"",[["B",b]])},createSensorIntervalMessage:function(a,b,c){return a=a.charAt(0).toUpperCase()+a.slice(1),e("set"+a+"Interval","",[["f",c]])},createVibrateMessage:function(){return e("vibrate","",[])},createControlsUrlMessage:function(a){return e("loadControlsUrl","",[["*",a]])},createMessageToJs:function(a,b){return e("messageToJs","",[["*",a],["@",g(b)]])}}},{"../enum/channel-type":17,"../enum/encoding-type":21}],16:[function(a,b){"use strict";var c=a("../enum/encoding-type"),d=a("../environment/index"),e=[],f=function(a){return d.base64Encode(a)},g=function(a){return(255&a.major)<<24|(255&a.minor)<<16},h=function(a,b){var d,e,g,h,i=32768,j=[],k=a.length,l=0,m=0;for(l=0;k>l;l+=i)d=f(a.substr(l,i)),e=d[0],g=d[1],j.push({encodeType:c.BYTE_CHUNK,setId:b,startByte:m,chunkSize:e,data:g}),m+=e;for(h=j.length;--h>-1;)j[h].totalSize=m;return j},i=function(a){return[a.encodeType,a.type,a.id,a.name]},j=function(a){return[c.ACK,i(a.device),r(a.address)]},k=function(a){return[c.PING,a.uid,r(a.address)]},l=function(){return[c.SHAKE,0]},m=function(a){return[c.BYTE_CHUNK,a.setId,a.startByte,a.chunkSize,a.totalSize,a.data]},n=function(a){var b,d,e=a.array,f=[c.TAGGED_ARRAY,e.length],g=e.length;for(b=0;g>b;++b)d=e[b],f.push(d[0]),f.push("@"===d[0]?p(d[1]):d[1]);return f},o=function(a){var b=[c.REGISTRY_INFO,i(a.device),r(a.address),a.appId,a.slotId];return a.slotId>0&&(b.push(a.currentPlayers),b.push(a.maxPlayers)),b},p=function(a){var b=e[a.encodeType];if(b)return b(a);throw new Error("[websocket-serializer]:: No encoder for "+JSON.stringify(a,null,3))},q=function(a){return[c.PACKET,a.channel,a.sequence,0,0,a.type,a.deviceType,a.deviceId,a.deviceName,!0,p(a.message)]},r=function(a){return[c.ADDRESS,a.hostname,a.udpPort,a.tcpPort]},s=function(a){return[c.PARAMETER,a[0],"@"===a[0]?p(a[1]):a[1]]},t=function(a){var b,d=a.params,e=[c.INVOKE,0,a.method,a.returnMethod,d.length],f=d.length;for(b=0;f>b;++b)e.push(s(d[b]));return e},u=function(a){return[c.ACCELERATION,a.x,a.y,a.z]},v=function(a){var b,d,e=a.touches,f=[c.TOUCH_SET,e.length],g=e.length;for(b=0;g>b;++b)d=e[b],f.push(d.x,d.y,d.viewWidth,d.viewHeight,d.phase,d.id);return f},w=function(a){return[c.GYRO,a.x,a.y,a.z]},x=function(a){return[c.ORIENTATION,a.x,a.y,a.z,a.w]},y=function(a){return[c.DPAD,a.horizontal,a.vertical]},z=function(a){return[c.SLIDER,a.value,a.id,a.isDown?!0:!1]};!function(){e[c.PACKET]=q,e[c.ADDRESS]=r,e[c.PARAMETER]=s,e[c.INVOKE]=t,e[c.ACCELERATION]=u,e[c.TOUCH_SET]=v,e[c.ACK]=j,e[c.PING]=k,e[c.SHAKE]=l,e[c.BYTE_CHUNK]=m,e[c.TAGGED_ARRAY]=n,e[c.REGISTRY_INFO]=o,e[c.GYRO]=w,e[c.ORIENTATION]=x,e[c.DPAD]=y,e[c.SLIDER]=z,e[c.DEVICE_IPHONE]=i,e[c.DEVICE_UNITY]=i,e[c.DEVICE_ANDROID]=i,e[c.DEVICE_NATIVE]=i,e[c.DEVICE_PALM]=i,e[c.DEVICE_FLASH]=i}(),b.exports={createHandshake:function(a,b){return[g(a),g(b)]},generateControlChunks:function(a){return h(a,"testXML")},generateUpdateChunks:function(a){return h(a,"updateXML")},encodeObject:p,encodePacket:q}},{"../enum/encoding-type":21,"../environment/index":25}],17:[function(a,b){"use strict";b.exports={BROADCAST:0,ACCELERATION:1,TOUCH:2,MESSAGE:3,SHAKE:4,BYTE:5,GYRO:6,ORIENTATION:7,DPAD:8,SLIDER:9}},{}],18:[function(a,b){"use strict";var c="gamepad",d="keyboard",e="navigation",f="wait",g="html",h=[c,d,e,f,g];b.exports={GAMEPAD:c,KEYBOARD:d,NAVIGATION:e,WAIT:f,HTML:g,index:function(a){return h.indexOf(a)},value:function(a){return a=0>a?0:a,a=a>h.length-1?h.length-1:a,h[a]},isValid:function(a){return this.index(a)>-1}}},{}],19:[function(a,b){"use strict";b.exports={ANY:0,UNITY:1,IPHONE:2,FLASH:3,ANDROID:4,NATIVE:5}},{}],20:[function(a,b){"use strict";b.exports={DEAD:0,UP:-1,DOWN:1,LEFT:-1,RIGHT:1}},{}],21:[function(a,b){"use strict";b.exports={PACKET:0,ADDRESS:1,PARAMETER:3,INVOKE:4,ACCELERATION:5,TOUCH_SET:6,DEVICE_IPHONE:7,DEVICE_UNITY:8,DEVICE_ANDROID:10,DEVICE_NATIVE:15,DEVICE_PALM:16,DEVICE_SERVER:17,DEVICE_FLASH:18,ACK:9,PING:11,SHAKE:13,BYTE_CHUNK:14,REGISTRY_INFO:19,TAGGED_ARRAY:21,GYRO:22,ORIENTATION:23,DPAD:24,SLIDER:25}},{}],22:[function(a,b){"use strict";b.exports={ERROR:0,APPLICATION_ID_REQUIRED:1,RUNTIME_FAILURE:2,REGISTER_FAILURE:3}},{}],23:[function(a,b){"use strict";b.exports={DATA:0,PING:1,ACK:2,ECHO:3,ANALYSIS:4,KEEP_ALIVE:5}},{}],24:[function(a,b){"use strict";var c=a("../../lib/base64"),d=!1;if("btoa"in window){var e=c.encode;c.encode=function(a){try{return[a.length,window.btoa(a)]}catch(b){return e(a)}}}b.exports={globalName:"red5prosecondscreenhost"+Math.floor(16777215*Math.random()*16777215).toString(16),exposeNoConflict:function(a){var b,c=function(){return"undefined"!=typeof b&&(window.secondscreenHost=b),a};"secondscreenHost"in window?b=window.secondscreenHost:(a.noConflict=c,window.secondscreenHost=a)},defineGlobalTarget:function(a){window[this.globalName]=a},getGlobalTarget:function(){return window[this.globalName]},getLocationSearch:function(){return document.location.search},getUserAgent:function(){return navigator.userAgent},getAppName:function(){return navigator.appName},loadComplete:function(){return"complete"===document.readyState||"interactive"===document.readyState},addLoadListener:function(a){window.addEventListener?window.addEventListener("DOMContentLoaded",a,!1):window.attachEvent("onload",a)},injectScript:function(a,b){var c=document.createElement("script");c.type="text/javascript",c.onload=b,c.onreadystatechange=function(){("loaded"===c.readyState||"complete"===c.readyState)&&(c.onreadystatechange=null,b())},c.src=a,document.getElementsByTagName("head")[0].appendChild(c)},getSwfObject:function(){return window.swfobject},createElement:function(a){return document.createElement(a)},getElement:function(a){return document.getElementById(a)},appendElementToBody:function(a){document.body.appendChild(a)},appendElementToContainer:function(a,b){b.appendChild(a)},loadImage:function(a,b,c){var d=new Image,e=this;d.onload=function(){var b,f=e.createElement("canvas"),g=f.getContext("2d");f.width=d.width,f.height=d.height,g.drawImage(d,0,0),b=f.toDataURL().replace("data:image/png;base64,",""),c({data:b,width:d.width,height:d.height,url:a})},d.onerror=b,d.src=a},supportsWebSockets:function(){return!d&&"WebSocket"in window},supportsBTOAEncoding:function(){return"btoa"in window},base64Encode:function(a){return c.encode(a)},createWebSocket:function(a){return new WebSocket(a)},getAbsoluteUrl:function(a){var b=document.createElement("img");return b.src=a,a=b.src,b.src=null,a},forceFlash:function(){d=!0}}},{"../../lib/base64":1}],25:[function(a,b){(function(c){var d=c.browser;b.exports=a(d?"./browser":"./node")}).call(this,a("JkpR2F"))},{"./browser":24,"./node":2,JkpR2F:3}],26:[function(a,b){"use strict";var c=a("../struct/base-classes"),d={DEVICE_CONN_REQUEST:"connectrequest",REGISTRY_DISCONNECT:"registrydisconnect",SHOW_SLOT_COLOR:"showslotcolor",CONNECTION_MESSAGE:"connectionmessage",DEVICE_MESSAGE:"devicemessage"},e={ADD_DEVICE:"adddevice",REMOVE_DEVICE:"removedevice",DEVICE_ERROR:"deviceerror",CONTROL_SCHEME:"controlscheme",SEND_PORTAL_ID:"sendportalid",SET_CAPABILITIES:"setcapabilities",DEVICE_CONNECTED:"deviceconnected",DEVICE_DISCONNECTED:"devicedisconnected",DEVICE_CONN_ERROR:"deviceconnecterror",FLASH_RUNTIME_LOADED:"flashruntimeloaded"},f={PAUSE:"pause",WAIT_CANCELLED:"waitcancelled",NAVIGATION:"navstring",KEYBOARD:"keyboard",BUTTON_UP:"buttonup",BUTTON_DOWN:"buttondown",SHAKE:"shake",ACCELERATION:"acceleration",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",GYROSCOPE:"gyroscope",ORIENTATION:"orientation",DPAD:"dpad",SLIDER:"slider",MESSAGE:"message",CONTROLS_URL_CHANGE:"controlsurlchange"},g=c.EventEmitter.extend({init:function(){this._super(),this.EventTypes=d,this.DeviceEventTypes=f,this.ConnectionEventTypes=e},triggerDeviceMessage:function(a,b){this.trigger(this.EventTypes.DEVICE_MESSAGE,{type:a,data:b})},triggerConnectionMessage:function(a,b){this.trigger(this.EventTypes.CONNECTION_MESSAGE,{type:a,data:b})}});b.exports=new g},{"../struct/base-classes":32}],27:[function(a,b){"use strict";var c="log",d="info",e="debug",f="warn",g="error",h="none",i=0,j=[c,d,e,f,g],k=function(a){var b,c=16;if(a.length>c)b=a.substr(0,c-1);else for(b=a;b.length<c-1;)b+=" ";return b},l=function(a){this.name=k(a)};l.prototype.format=function(a,b){var c=new Date,d=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+":"+c.getMilliseconds();return"-"+this.name+"- "+d+" ["+a.toUpperCase()+"] :: "+b},l.prototype.print=function(a,b){var c=j.indexOf(a);0===c?console.log(this.format(a,b)):c>=i&&console[a](this.format(a,b))},function(a,b){for(var c=a.length;--c>-1;)!function(a){b[a]=function(b){this.print.call(this,a,b)}}(a[c])}(j,l.prototype),b.exports={LogLevels:{LOG:c,INFO:d,DEBUG:e,WARN:f,ERROR:g,NONE:h},setLogLevel:function(a){var b=j.indexOf(a);b>-1?i=b:a===h&&(i=j.length)},getLogger:function(a){return new l(a)}}},{}],28:[function(a,b){var c=a("../struct/base-classes"),d=a("../event/bridge"),e=a("../device/device-factory"),f=a("../device/flash-channel-responder"),g=a("../browser/detection"),h=a("../browser/plugin/flash-util"),i=a("../util/bind"),j=a("../util/resource-util"),k=a("../log/logger"),l=a("../enum/control-mode-type"),m=d.EventTypes,n=d.ConnectionEventTypes,o=k.getLogger("Flash Runtime"),p=function(a){var b=a.options.design;if("string"==typeof b)h.initializeFlashObject([],a);else if(-1!==g.detectInternetExplorerVersion())o.warn("IE version detected that does not allow Image preloading."),h.initializeFlashObject([],a);else if("object"==typeof b){var c=b.images?b.images:[];c&&0===c.length?h.initializeFlashObject(c,a):(o.info("Loading resource image before initalizing object embed..."),j.loadImages(c,function(b){h.initializeFlashObject(b,a)}))}},q=c.Class.extend({init:function(){this.flashObjID=Math.floor(16777215*Math.random()*16777215).toString(16),this.handleConnectionMessage=i(this.handleConnectionMessage,this),this.handleDeviceConnectRequest=i(this.handleDeviceConnectRequest,this),this.responder=f.create(),this.pendingConnections=[],this.pending=!1},start:function(a){var b;return a.flashObjID=this.flashObjID,this.config=a,this.pending=!0,b=this.config._success,function(a){a.config._success=function(){a.pending=!1,b.apply(a.config,arguments)}}(this),o.info("Starting Flash Runtime instance as Host Runtime."),o.info("FlashObjectId: "+a.flashObjID),o.info("SWF file to load: "+a.options.swfUrl),d.on(m.CONNECTION_MESSAGE,this.handleConnectionMessage),d.on(m.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),g.onLoad(p,this.config),this},stop:function(){return o.info("Stopping Flash Runtime instance as Host Runtime."),this.getFlashObject().stop(),this.config=void 0,this.responder.unregisterAll(),d.off(m.CONNECTION_MESSAGE,this.handleConnectionMessage),d.off(m.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this},getPendingConnectionIndex:function(a){for(var b=this.pendingConnections.length;--b>-1;)if(this.pendingConnections[b].id===a.id)return b;return-1},addPendingConnection:function(a){var b=this.getPendingConnectionIndex(a);-1===b&&(this.pendingConnections.push(a),this.responder.register(a))},removePendingConnection:function(a){var b=this.getPendingConnectionIndex(a);b>-1&&this.pendingConnections.splice(b,1)},addConnection:function(a){this.removePendingConnection(a)},removeConnection:function(a){this.responder.unregister(a)},setVisibility:function(a){var b=this.getFlashObject();if(void 0!==b)try{b.SetVisibility(a,!0)}catch(c){}},getFlashObject:function(){return h.getFlashObjectById(this.flashObjID)},handleConnectionMessage:function(a){a.type===n.FLASH_RUNTIME_LOADED?(o.info("Flash Runtime Embedded and Loaded."),this.responder.target=this.getFlashObject()):a.type===n.ADD_DEVICE?this.addConnection(a.data.device):a.type===n.REMOVE_DEVICE&&this.removeConnection(a.data.device)},handleDeviceConnectRequest:function(a){var b,c=a.deviceId,d=a.deviceName,f=l.value(a.controlMode);b=e.createBridgeConnection(d,c,f,this.config,this.getFlashObject()),this.addPendingConnection(b)}});b.exports={Runtime:q}},{"../browser/detection":4,"../browser/plugin/flash-util":5,"../device/device-factory":9,"../device/flash-channel-responder":11,"../enum/control-mode-type":18,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/resource-util":38}],29:[function(a,b){"use strict";var c=a("./flash"),d=a("./websockets"),e=a("../environment/index"),f={FLASH:0,WEBSOCKETS:1};b.exports={RuntimeTypes:f,getRuntimeType:function(){return e.supportsWebSockets()?f.WEBSOCKETS:f.FLASH},getRuntime:function(a){return this.getRuntimeType()===f.WEBSOCKETS?new d.Runtime(a):new c.Runtime(a)}}},{"../environment/index":25,"./flash":28,"./websockets":30}],30:[function(a,b){"use strict";var c=a("../struct/base-classes"),d=a("../event/bridge"),e=a("../util/bind"),f=a("../connection/registry"),g=a("../device/device-factory"),h=a("../util/resource-util"),i=a("../log/logger"),j=a("../enum/encoding-type"),k=a("../enum/device-type"),l=a("../enum/error-type"),m=d.EventTypes,n=d.ConnectionEventTypes,o=0,p=c.Class.extend({init:function(){this.id=++o,this.hostDevice={id:void 0,name:void 0,type:k.FLASH,encodeType:j.DEVICE_FLASH},this.hostAddress={hostname:"unknown",udpPort:0,tcpPort:0,encodeType:j.ADDRESS},this.registry=void 0,this.config=void 0,this.connections=[],this.pendingConnections=[],this.pending=!1,this.logger=i.getLogger("WebSockets Runtime")},start:function(a){this.config=a,this.hostDevice.name=this.config.options.name,this.hostDevice.id=this.config.options.deviceId,this.handleConnectionMessage=e(this.handleConnectionMessage,this),this.handleDeviceConnectRequest=e(this.handleDeviceConnectRequest,this),h.preloadDesignImages(this.config.options.design),d.on(m.CONNECTION_MESSAGE,this.handleConnectionMessage),d.on(m.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this.logger.info("Starting Websockets Runtime with host id "+this.hostDevice.id);try{this.registry=f.createWebSocketRegistry(this.config),this.registry.start()}catch(b){throw new Error({type:l.RUNTIME_FAILURE,message:b.message})}return this},stop:function(){for(this.logger.info("Stopping WebSockets Runtime with host id "+this.hostDevice.id);this.connections.length>0;)this.removeConnection(this.connections.shift());return this.connections.length=0,this.registry.stop(),this.config=void 0,d.off(m.CONNECTION_MESSAGE,this.handleConnectionMessage),d.off(m.DEVICE_CONN_REQUEST,this.handleDeviceConnectRequest),this},setVisibility:function(a){this.registry.setVisibility(a)},hasReachMaxConnections:function(){return this.connections.length>=this.config.options.maxPlayers},connectionAlreadyRegistered:function(a){for(var b=this.connections.length;--b>-1;)if(this.connections[b].id===a)return!0;return!1},getPendingConnectionIndex:function(a){for(var b=this.pendingConnections.length;--b>-1;)if(this.pendingConnections[b].id===a.id)return b;return-1},addPendingConnection:function(a){var b=this.getPendingConnectionIndex(a);-1===b&&this.pendingConnections.push(a)},removePendingConnection:function(a){var b=this.getPendingConnectionIndex(a);b>-1&&this.pendingConnections.splice(b,1)},addConnection:function(a){this.connections.push(a),this.removePendingConnection(a),this.registry.setPlayerCount(this.connections.length),this.logger.info("Adding connection to Host Runtime...")},removeConnection:function(a){var b=this.connections.indexOf(a);b>-1&&(this.logger.info("Removing connection from Host Runtime..."),this.connections.splice(b,1),this.registry.setPlayerCount(this.connections.length))},handleConnectionMessage:function(a){this.logger.info("Message received form connection device. Event: "+a.type+", device id: "+a.data.device.id),a.type===n.ADD_DEVICE?this.addConnection(a.data.device):a.type===n.REMOVE_DEVICE&&this.removeConnection(a.data.device)},handleDeviceConnectRequest:function(a){var b,c,d=a.device.deviceId,e=a.device.deviceName,f=a.address;this.logger.info("Attempting to connection to device "+d),this.hasReachMaxConnections()?this.logger.warn("Maximium connections already reached. Not connecting to "+d+"."):this.connectionAlreadyRegistered(d)?this.logger.warn("Already connected to "+d+"."):(b="ws://"+f.host+":"+f.reliablePort,this.logger.info("Request to connect to device at "+b+"."),c=g.createDeviceConnection(e,d,this.config),c.connect(b,this.hostDevice,this.hostAddress),this.addPendingConnection(c))}});b.exports={Runtime:p}},{"../connection/registry":6,"../device/device-factory":9,"../enum/device-type":19,"../enum/encoding-type":21,"../enum/error-type":22,"../event/bridge":26,"../log/logger":27,"../struct/base-classes":32,"../util/bind":33,"../util/resource-util":38}],31:[function(a,b){"use strict";var c=a("./struct/base-classes"),d=a("./log/logger"),e=a("./event/bridge"),f=a("./device/device-factory"),g=a("./runtime/runtime-factory"),h=a("./util/bind"),i=a("./util/proxy"),j=a("./environment/index"),k=a("./enum/error-type"),l=a("./enum/control-mode-type"),m=e.EventTypes,n=e.ConnectionEventTypes,o=e.DeviceEventTypes,p=a("./enum/dpad-controls"),q="0.4.3",r="none",s=!0,t={name:"Red5 Pro SecondScreen Host",maxPlayers:1,appId:"secondscreen",swfUrl:"swf/secondscreenHost.swf",swfobjectUrl:"swf/swfobject.js",minimumVersion:{major:0,minor:0},design:{orientation:"portrait",touchEnabled:!1,accelerometerEnabled:!1,preload:[],layout:[],images:[]},error:function(){},success:function(){},_error:function(){this.error&&this.error.apply(null,Array.prototype.slice.call(arguments))},_success:function(){this.success&&this.success.apply(null,Array.prototype.slice.call(arguments))}},u=function(a,b){var c;for(c in a)b[c]=a[c];return b},v=function(a){var b,c={},d=/[?&]?([^=]+)=([^&]*)/g;for(a=a.split("+").join(" ");b=d.exec(a);)c[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return c},w=function(){return Math.floor(16777215*Math.random()*16777215).toString(16)},x=function(a,b,c){a.hasOwnProperty(b)&&!c.hasOwnProperty(b)?c[b]=a[b]:a[b]=c[b]},y=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},z=function(){return y({SHOW_SLOT_COLOR:m.SHOW_SLOT_COLOR},y(o,n))},A=["#ff6600","#ffcc00","#ff3399","#ff0066","#cc00ff","#999900","#9999cc","#00cc99","#287200","#00ccff","#003366","#99ff00","#cc0000","#80cd68","#6600ff"],B=0,C=c.EventEmitter.extend({init:function(){var a;this._super(),this.uid=++B,a=v(j.getLocationSearch()),this.appId=a.appId,this.portalId=a.portalId,this.deviceId=a.appId||w(),this.version=q,this.devices={},this.runtime=void 0,this.config={options:t},this.log=d.getLogger("Red5 Pro SecondScreen Host"),this.handleShowSlotColor=h(this.handleShowSlotColor,this),this.handleDeviceMessage=h(this.handleDeviceMessage,this),this.handleConnectionMessage=h(this.handleConnectionMessage,this)},addEventHandlers:function(){this.removeEventHandlers(),e.on(m.DEVICE_MESSAGE,this.handleDeviceMessage),e.on(m.SHOW_SLOT_COLOR,this.handleShowSlotColor),e.on(m.CONNECTION_MESSAGE,this.handleConnectionMessage)},removeEventHandlers:function(){e.off(m.DEVICE_MESSAGE,this.handleDeviceMessage),e.off(m.SHOW_SLOT_COLOR,this.handleShowSlotColor),e.off(m.CONNECTION_MESSAGE,this.handleConnectionMessage)},start:function(a,b){if("undefined"!=typeof a&&(this.config.options=u(a,this.config.options)),x(this,"appId",this.config.options),x(this,"portalId",this.config.options),x(this,"deviceId",this.config.options),!this.config.options.appId){var c="A proper application id is required for Red5 Pro SecondScreenHost. Provided application id: "+this.config.options.appId;throw this.log.error(c),this.config.options._error(k.APPLICATION_ID_REQUIRED,c),new Error({type:k.APPLICATION_ID_REQUIRED,message:c})}this.appId=this.config.options.appId,"undefined"!=typeof b&&b&&j.forceFlash();try{this.log.info(this.versionStr()),this.runtime=g.getRuntime().start(this.config),this.runtime.pending||this.config.options._success(),this.addEventHandlers(),this.log.info("Started with appId "+this.config.options.appId)}catch(d){throw this.removeEventHandlers(),this.config.options._error(d.type,"Could not start SecondScreenHost Runtime: "+d.message+"."),new Error(d)}},stop:function(){var a;this.log.info("Stopping SecondScreenHost instance with appId "+this.config.options.appId),"undefined"!=typeof this.runtime&&this.runtime.stop();for(a in this.devices)this.removeDeviceById(a);this.runtime=void 0,this.removeEventHandlers()},getDeviceById:function(a){return this.devices.hasOwnProperty(a)?this.devices[a]:void 0},allDevices:function(){return function(){return i.initializeWithMap(this.devices,f.getProxyMethods())}}(),setVisibility:function(a){s!==a&&(s=a,"undefined"!=typeof this.runtime&&(this.log.info("Setting visibility on runtime to "+a+"."),this.runtime.setVisibility(s)))},getVisibility:function(){return s},addDevice:function(a){this.log.info("Request to add device "+a.id+"."),this.devices[a.id]=a,this.trigger(n.DEVICE_CONNECTED,{device:a})},removeDeviceById:function(a){var b;this.log.info("Request to remove device "+a+"."),this.getDeviceById(a)?(b=this.devices[a],b.close(),this.log.info("Removing device "+a+"."),delete this.devices[a],this.trigger(n.DEVICE_DISCONNECTED,{device:b})):this.log.warn("Could not find device in list: "+a+".")},versionStr:function(){return"Red5 Pro SecondScreenHost :) Version "+this.version},setLogLevel:function(a){d.setLogLevel(a)},handleShowSlotColor:function(a){var b=a.data.slot,c=Math.max(0,b-1)%A.length,d=A[c];this.log.info("Show Slot Color for id "+b+", color: "+d),this.trigger(a.type,{slot:b,color:d})},handleConnectionMessage:function(a){this.log.info("Event receieved on Connection for device "+a.data.device.id+": "+a.type),a.type===n.ADD_DEVICE?this.addDevice(a.data.device):a.type===n.REMOVE_DEVICE&&this.removeDeviceById(a.data.device.id),this.trigger(a.type,a.data)},handleDeviceMessage:function(a){this.log.info("Event receieved on Device for device "+a.data.device.id+": "+a.type),this.trigger(a.type,a.data)}}),D=new C;D.ErrorTypes=k,D.EventTypes=z(),D.ControlModes=l,D.LogLevels=d.LogLevels,D.SlotColors=A,D.DPadControls=p,d.setLogLevel(r),j.exposeNoConflict(D),b.exports=D},{"./device/device-factory":9,"./enum/control-mode-type":18,"./enum/dpad-controls":20,"./enum/error-type":22,"./environment/index":25,"./event/bridge":26,"./log/logger":27,"./runtime/runtime-factory":29,"./struct/base-classes":32,"./util/bind":33,"./util/proxy":37}],32:[function(a,b){function c(){}var d=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;c.extend=function(a){function b(){!d&&this.init&&this.init.apply(this,arguments)}var c=this.prototype;d=!0;var f=new this;d=!1;for(var g in a)f[g]="function"==typeof a[g]&&"function"==typeof c[g]&&e.test(a[g])?function(a,b){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);return this._super=d,e}}(g,a[g]):a[g];return b.prototype=f,b.prototype.constructor=b,b.extend=arguments.callee,b},EventEmitter=c.extend({init:function(){this.callbacks={}},addEventListener:function(a,b){if("function"!=typeof b)throw new Error(".on() callback provided was not a function");void 0===this.callbacks[a]&&(this.callbacks[a]=[]),-1===this.getIndexOfFunctionByType(a,b)&&this.callbacks[a].push(b)},on:function(a,b){this.addEventListener(a,b)},removeEventListener:function(a,b){if(void 0!==this.callbacks[a]){var c=this.callbacks[a],d=this.getIndexOfFunctionByType(a,b);d>-1&&c.splice(d,1)}},getIndexOfFunctionByType:function(a,b){if(void 0!==this.callbacks[a]){var c,d=this.callbacks[a];for(c=0;c<d.length;c++)if(d[c]==b)return c;return-1}return-1},off:function(a,b){this.removeEventListener(a,b)},trigger:function(a,b){if(void 0!==this.callbacks[a])for(var c,d=this.callbacks[a],c=0;c<d.length;c++)d[c](b)},triggerWithType:function(a,b){b.type=a,this.trigger(a,b)}}),b.exports={Class:c,EventEmitter:EventEmitter}},{}],33:[function(a,b){"use strict";b.exports=function(a,b){return function(){return a.apply(b,arguments)}}},{}],34:[function(a,b){"use strict";b.exports=function(a,b,c){var d,e=function(){clearTimeout(d),a.apply(c,arguments)};return function(){clearTimeout(d),d=setTimeout(e,b,arguments)}}},{}],35:[function(a,b){"use strict";var c=a("../struct/base-classes"),d=a("../environment/index"),e=c.Class.extend({init:function(){this.store={},this.indexStore=[]},setCache:function(a,b){this.store[a]=b,this.indexStore.push(a)},getCache:function(a){return this.store.hasOwnProperty(a)?this.store[a]:void 0},getResourceId:function(a){return"undefined"==typeof a?-1:this.indexStore.indexOf(a)+1}}),f=c.Class.extend({init:function(a,b,c){this.store=a,this.imageUrls=b||[],this.imageData=[],this.queue=[],this.callback=c},_load:function(a){!function(b){d.loadImage(a,function(){b.next()},function(c){b.imageData.push(c),b.store.setCache(a,c),b.next()})}(this)},start:function(){var a,b,c,d=this.imageUrls.length;for(a=0;d>a;a++)b=this.imageUrls[a],c=this.store.getCache(b),c?this.imageData.push(c):this.queue.push(b);this.next()},next:function(){this.queue.length>0?this._load(this.queue.shift()):this.callback&&this.callback.call(null,this.imageData)}}),g=new e;b.exports={loadImages:function(a,b){new f(g,a,b).start()},getCacheFromUrl:function(a){return g.getCache(a)},getResourceIdFromUrl:function(a){return g.getResourceId(a)}}},{"../environment/index":25,"../struct/base-classes":32}],36:[function(a,b){"use strict";b.exports={toJSON:function(a){try{return JSON.parse(decodeURIComponent(a))}catch(b){}return void 0}}},{}],37:[function(a,b){"use strict";var c=function(a){this.objectMap=a},d=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);a.execute.apply(a,[b].concat(c))}};c.prototype={execute:function(){var a,b,c=arguments[0],d=Array.prototype.slice.call(arguments).slice(1);for(a in this.objectMap)b=this.objectMap[a],b[c].apply(b,d);return this}},b.exports={initializeWithMap:function(a,b){var e,f,g=new c(a),h=b.length;for(e=0;h>e;e++)f=b[e],g[f]=d(g,f);return g}}},{}],38:[function(a,b){"use strict";var c=a("./image-cache-resource"),d=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},e=function(a,b){"undefined"!=typeof a&&-1===b.indexOf(a)&&(b[b.length]=a)},f=function(a){var b,c,d,f,g=a.layout;if(void 0!==g){for(c=g.length,f=a.__resources__||(a.preload?a.preload.slice():[]),b=0;c>b;b++)d=g[b],"image"===d.type?e(d.src,f):"button"===d.type?(e(d.srcUp,f),e(d.srcDown,f)):"slider"===d.type&&(e(d.srcUp,f),e(d.srcDown,f),e(d.srcBackground,f));return a.__resources__=f,f}},g=function(a){var b="",d=a.src||a.srcUp,e=a.srcDown,f=a.srcBackground,g=c.getResourceIdFromUrl(d)||-1,h=c.getResourceIdFromUrl(e)||-1,i=c.getResourceIdFromUrl(f)||-1;return"image"===a.type?b+='<Asset name="up" resourceRef="'+g+'" />':"button"===a.type?(b+='<Asset name="up" resourceRef="'+g+'" />',b+='<Asset name="down" resourceRef="'+h+'" />'):"slider"===a.type&&(b+='<Asset name="up" resourceRef="'+g+'" />',b+='<Asset name="down" resourceRef="'+h+'" />',b+='<Asset name="background" resourceRef="'+i+'" />'),b},h=function(a,b,d){var e,f=a.src||a.srcUp,h=c.getCacheFromUrl(f),i=c.getResourceIdFromUrl(f)||-1;return a.x=void 0===a.x?0:a.x,a.y=void 0===a.y?0:a.y,void 0===a.width&&void 0!==h&&(a.width=h.width),void 0===a.height&&void 0!==h&&(a.height=h.height),e='<DisplayObject type="'+a.type+'" top="'+a.y/d+'" left="'+a.x/b+'" width="'+a.width/b+'" height="'+a.height/d+'" id="'+i+'" ',"button"===a.type&&a.id?e+='functionHandler="'+a.id+'" ':"slider"===a.type&&(e+='sliderId="'+a.sliderId+'" ',e+='orientation="'+(a.orientation?a.orientation.toLowerCase():"horizontal")+'" ',e+='handleWidth="'+a.handleWidth/b+'" ',e+='handleHeight="'+a.handleHeight/d+'" '),a.text&&(e+='text="'+a.text+'" textSize="'+Number(a.textSize)/d+'" '),void 0!==a.color&&(e+='color="'+a.color+'" '),a.hidden&&(e+='hidden="yes" '),e+=">",e+=g(a),e+="</DisplayObject>"},i=function(a){var b,c=a.layout,d=a.width,e=a.height,f=c?c.length:0,g="<Layout/>",i=[];if(f>0){for(i.push("<Layout>"),b=0;f>b;b++)i.push(h(c[b],d,e));i.push("</Layout>"),g=i.join("\n")}return g},j=function(a,b){var d,e,f=b.length,g=["<Resources>"];for(d=0;f>d;d++)e=b[d],g.push('<Resource id="'+c.getResourceIdFromUrl(e.url)+'" type="image"><data><![CDATA['+e.data+"]]></data></Resource>");return g.push("</Resources>"),g.join("\n")},k=function(a,b){var c;return"portrait"===a.orientation?(a.width=320,a.height=480):(a.width=480,a.height=320),c='<?xml version="1.0" encoding="utf-8"?>\n<BMApplicationScheme version="0.1" orientation="'+a.orientation+'" touchEnabled="'+(a.touchEnabled?"yes":"no")+'" accelerometerEnabled="'+(a.accelerometerEnabled?"yes":"no")+'">\n',c+=j(a,b),c+=i(a),c+="</BMApplicationScheme>"};b.exports={cloneDesign:function(a){for(var b=d(a),c=a.layout,e=c?c.length:0,f=new Array(e);--e>-1;)f[e]=d(c[e]);return b.__resources__&&(b.__resources__=b.__resources__.slice()),b.layout=f,b},preloadDesignImages:function(a){c.loadImages(f(a))},generateControllerXML:function(a,b){c.loadImages(f(a),function(c){b&&b.call(null,k(a,c))})},generateUpdateXML:function(a){return"<BMApplicationScheme>"+i(a)+"</BMApplicationScheme>"}}},{"./image-cache-resource":35}]},{},[31]);